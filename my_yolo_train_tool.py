import cv2
import numpy as np
import time
import tkinter as tk
from tkinter import ttk
from tkinter import messagebox
from tkinter import filedialog
from tkinter import Menu
from tkinter import simpledialog
from tkinter import Label, Tk, StringVar
import threading
import os
import webbrowser
import sys
import base64
import portalocker
import mss
import php
import keyboard
from flask import Flask, render_template, jsonify, request

my = php.kit()
pwd = os.path.dirname(os.path.realpath(sys.argv[0]))  # 取得 exe 檔案的目錄路徑
if my.is_dir(pwd + my.SP() + "data") == False:
    my.mkdir(pwd + my.SP() + "data")
if my.is_dir(pwd + my.SP() + "data" + my.SP() + "projects") == False:
    my.mkdir(pwd + my.SP() + "data" + my.SP() + "projects")

GDATA = {
    "VERSION": "0.01",
    "UI": {},
    "THREAD": {},
    "pwd": pwd,
    "recording": False,  # 錄製狀態
    "out": None,
    "record_area": None,
    "x1": 0,
    "xy": 0,
    "x2": 0,
    "y2": 0,
    "rect": None,
    "frame_list": [],  # 幀列表
    "run_start_time": None,  # 影片開始轉檔時間
    "run_end_time": None,  # 影片結束轉檔時間
}

lock_file = pwd + "\\lock.txt"

# 檢查是否存在鎖定檔案並創建文件鎖
# 防程式重複啟動
check_file_run = open(lock_file, "a+")
try:
    portalocker.lock(check_file_run, portalocker.LOCK_EX | portalocker.LOCK_NB)
except:
    messagebox.showinfo("說明", "程式已執行了...")
    sys.exit()


MESSAGE = f"""
我的悠嘍訓練機

版本: {GDATA["VERSION"]}
作者: 羽山 (https://3wa.tw)  
    
"""
icon_b64 = "AAABAAEAWFgAAAEAIABIfQAAFgAAACgAAABYAAAAsAAAAAEAIAAAAAAAAHkAAMEOAADBDgAAAAAAAAAAAAD/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////vOGs/6TXj/+k14//pNeP/6TXj/+k14//pNeP/7Ddnf//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////0evG/4zMcP+T0Hn//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////4bKaf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////7zhrP+T0Hn/dMNT/1+5Of9fuTn/a75I///////////////////////R68b/vOGs//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+Gymn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/cMBO/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9Hrxv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of/R68b/////////////////pNeP/1+5Of9juz3/cMBO/4bKaf+T0Hn/0evG/////////////////////////////////////////////////6TXj///////////////////////////////////////////////////////hspp/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3DATv//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////dMNT/1+5Of9fuTn/X7k5/1+5Of9fuTn/nNSF/////////////////6TXj/9fuTn/X7k5/1+5Of9fuTn/X7k5/6TXj////////////////////////////////////////////6TXj/9fuTn/gMdi/////////////////////////////////////////////////4bKaf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7/////////////////////////////////////////////////sN2d/4DHYv///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////5PQef9fuTn/X7k5/1+5Of9fuTn/X7k5/4bKaf////////////////+k14//X7k5/1+5Of9fuTn/X7k5/1+5Of/R68b//////////////////////////////////////9Hrxv9nvUP/X7k5/1+5Of9wwE7/0evG//////////////////////////////////////+Gymn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/cMBO////////////////////////////////////////////sN2d/2O7Pf9fuTn/k9B5//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+84az/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7/////////////////jMxw/1+5Of9fuTn/X7k5/1+5Of9fuTn///////////+T0Hn/gMdi/6TXj/////////////////96xVr/X7k5/1+5Of9fuTn/X7k5/2u+SP/R68b/////////////////////////////////hspp/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3DATv//////////////////////////////////////sN2d/2O7Pf9fuTn/X7k5/1+5Of+w3Z3//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////2O7Pf9fuTn/X7k5/1+5Of9fuTn/Y7s9/////////////////4bKaf9fuTn/X7k5/1+5Of9fuTn/X7k5////////////dMNT/1+5Of9fuTn/Y7s9/3rFWv+Gymn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/a75I/9Hrxv///////////////////////////4bKaf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7/////////////////////////////////0evG/2u+SP9fuTn/X7k5/1+5Of9fuTn/Y7s9/7Ddnf////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9wwE7/X7k5/1+5Of9fuTn/X7k5/1+5Of+84az///////////+Gymn/X7k5/1+5Of9fuTn/X7k5/2u+SP///////////3DATv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9rvkj/0evG//////////////////////+Gymn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/cMBO/////////////////////////////////3DATv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9juz3/sN2d////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////hspp/1+5Of9fuTn/X7k5/1+5Of9fuTn/pNeP////////////esVa/1+5Of9fuTn/X7k5/1+5Of9wwE7///////////9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/2u+SP/R68b/////////////////hspp/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3DATv///////////////////////////4DHYv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/2e9Q//R68b//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////5PQef9fuTn/X7k5/1+5Of9fuTn/X7k5/4zMcP///////////3DATv9fuTn/X7k5/1+5Of9fuTn/dMNT//////+w3Z3/X7k5/1+5Of9fuTn/X7k5/1+5Of+Ax2L/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/cMBO/////////////////4bKaf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7//////////////////////5zUhf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/2u+SP+84az///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+k14//X7k5/1+5Of9fuTn/X7k5/1+5Of+Gymn///////////9wwE7/X7k5/1+5Of9fuTn/X7k5/4bKaf//////k9B5/1+5Of9fuTn/X7k5/1+5Of9juz3//////7Ddnf9juz3/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of96xVr///////////+Gymn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/cMBO/////////////////7zhrP9juz3/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3TDU//R68b/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////vOGs/1+5Of9fuTn/X7k5/1+5Of9fuTn/cMBO////////////Y7s9/1+5Of9fuTn/X7k5/1+5Of+Gymn//////4DHYv9fuTn/X7k5/1+5Of9fuTn/dMNT////////////0evG/2u+SP9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/5PQef//////hspp/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3DATv////////////////9rvkj/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3rFWv////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9fuTn/X7k5/1+5Of9fuTn/X7k5/3DATv///////////1+5Of9fuTn/X7k5/1+5Of9fuTn/pNeP//////9rvkj/X7k5/1+5Of9fuTn/X7k5/4zMcP/////////////////R68b/a75I/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9juz3/vOGs/4bKaf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7///////////+Gymn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3rFWv//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////a75I/1+5Of9fuTn/X7k5/1+5Of9fuTn//////7zhrP9fuTn/X7k5/1+5Of9fuTn/X7k5/6TXj///////X7k5/1+5Of9fuTn/X7k5/1+5Of+w3Z3//////////////////////9Hrxv9rvkj/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/2u+SP+Gymn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/cMBO//////+w3Z3/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3rFWv///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3DATv9fuTn/X7k5/1+5Of9fuTn/X7k5//////+k14//X7k5/1+5Of9fuTn/X7k5/1+5Of//////pNeP/1+5Of9fuTn/X7k5/1+5Of9juz3/////////////////////////////////0evG/2u+SP9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/Y7s9/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3DATv//////a75I/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3rFWv////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9wwE7/X7k5/1+5Of9fuTn/X7k5/1+5Of+84az/nNSF/1+5Of9fuTn/X7k5/1+5Of9fuTn//////4bKaf9fuTn/X7k5/1+5Of9fuTn/dMNT///////////////////////////////////////R68b/Y7s9/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7/jMxw/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/2u+SP/R68b/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////hspp/1+5Of9fuTn/X7k5/2e9Q/9wwE7/vOGs/5PQef9rvkj/X7k5/1+5Of9fuTn/cMBO//////9wwE7/X7k5/1+5Of9fuTn/X7k5/4zMcP///////////////////////////////////////////7Ddnf9juz3/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/Z71D/2O7Pf9fuTn/X7k5/1+5Of9fuTn/X7k5/2u+SP/R68b//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////6TXj/+c1IX/pNeP//////////////////////////////////////+w3Z3/k9B5/5PQef/R68b/X7k5/1+5Of9fuTn/X7k5/1+5Of+84az/////////////////////////////////////////////////k9B5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/2O7Pf+w3Z3////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////R68b//////////////////////////////////////////////////////////////////////7zhrP+T0Hn/a75I/2O7Pf9nvUP///////////////////////////////////////////////////////////90w1P/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+k14/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////R68b/X7k5/3TDU/+MzHD/pNeP/////////////////////////////////////////////////////////////////2u+SP9nvUP/cMBO/7Ddnf//////////////////////////////////////////////////////0evG/2O7Pf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+Gymn/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////k9B5/1+5Of9fuTn/X7k5/1+5Of9fuTn/a75I/3TDU/+Gymn/pNeP/7Ddnf////////////////////////////////9fuTn/X7k5/1+5Of9fuTn/Z71D/3rFWv////////////////////////////////////////////////+c1IX/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3TDU/9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/2u+SP90w1P/hspp/5PQef+c1IX/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7/cMBO/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/cMBO/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9Hrxv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/esVa/3DATv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3DATv////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+T0Hn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/4zMcP9wwE7/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////a75I/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+k14//cMBO/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/cMBO/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3rFWv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn//////3DATv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3DATv//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////sN2d/2O7Pf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/Z71D/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/cMBO//////9wwE7/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+w3Z3/Y7s9/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/2u+SP//////0evG/6TXj/+c1IX/hspp/3DATv9fuTn/X7k5/1+5Of9fuTn/X7k5/4bKaf//////cMBO/1+5Of9fuTn/X7k5/1+5Of9fuTn/pNeP////////////sN2d/7zhrP///////////6TXj/9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of////////////////+c1IX/sN2d////////////hspp/1+5Of9fuTn/X7k5/1+5Of9fuTn/cMBO/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////7Ddnf9juz3/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/esVa//////////////////////96xVr/X7k5/1+5Of9fuTn/X7k5/1+5Of+w3Z3//////3DATv9fuTn/X7k5/1+5Of9fuTn/X7k5/6TXj////////////4DHYv9fuTn/a75I/4bKaf+T0Hn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/sN2d/3TDU/9fuTn/X7k5/3DATv///////////4bKaf9fuTn/X7k5/1+5Of9fuTn/X7k5/3DATv//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////nNSF/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+MzHD/////////////////Z71D/1+5Of9fuTn/X7k5/1+5Of9juz3///////////9wwE7/X7k5/1+5Of9fuTn/X7k5/1+5Of+k14////////////9rvkj/X7k5/1+5Of9fuTn/gMdi/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/9Hrxv9juz3/X7k5/1+5Of9fuTn/pNeP//////+Gymn/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+Gymn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/7Ddnf//////vOGs/1+5Of9fuTn/X7k5/1+5Of9fuTn/dMNT////////////cMBO/1+5Of9fuTn/X7k5/1+5Of9fuTn/pNeP///////R68b/X7k5/1+5Of9fuTn/X7k5/5zUhf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of//////esVa/1+5Of9fuTn/X7k5/3rFWv//////hspp/1+5Of9fuTn/X7k5/1+5Of9fuTn/cMBO/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3TDU/9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9nvUP/0evG/4zMcP9fuTn/X7k5/1+5Of9fuTn/X7k5/5PQef///////////3DATv9fuTn/X7k5/1+5Of9fuTn/X7k5/6TXj///////k9B5/1+5Of9fuTn/X7k5/2u+SP+k14//X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn//////5zUhf9fuTn/X7k5/1+5Of9fuTn/vOGs/4bKaf9fuTn/X7k5/1+5Of9fuTn/X7k5/3DATv/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////R68b/Y7s9/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3TDU/+MzHD/Y7s9/1+5Of9fuTn/X7k5/1+5Of/R68b///////////9wwE7/X7k5/1+5Of9fuTn/X7k5/1+5Of+k14///////3TDU/9fuTn/X7k5/1+5Of+MzHD/pNeP/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5////////////Z71D/1+5Of9fuTn/X7k5/4bKaf+Gymn/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////7Ddnf/R68b//////////////////////6TXj/9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/k9B5//////+w3Z3/jMxw/3TDU/96xVr/////////////////cMBO/1+5Of9fuTn/X7k5/1+5Of9fuTn/pNeP/9Hrxv9fuTn/X7k5/1+5Of9fuTn/vOGs/6TXj/9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of///////////3rFWv9fuTn/X7k5/1+5Of9juz3/gMdi/1+5Of9fuTn/X7k5/1+5Of9fuTn/cMBO//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+Ax2L/X7k5/2u+SP+Ax2L/jMxw/6TXj/+w3Z3/gMdi/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/2O7Pf+84az//////////////////////////////////////3DATv9fuTn/X7k5/1+5Of9fuTn/X7k5/6TXj/+MzHD/X7k5/1+5Of9fuTn/cMBO//////+k14//X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn///////////+c1IX/X7k5/1+5Of9fuTn/X7k5/2e9Q/9fuTn/X7k5/1+5Of9fuTn/X7k5/3DATv//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Z71D/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/a75I//////////////////////////////////////9wwE7/X7k5/1+5Of9fuTn/X7k5/1+5Of+k14//hspp/2e9Q/9fuTn/X7k5/6TXj///////pNeP/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/////////////////1+5Of9fuTn/a75I/4bKaf96xVr/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////pNeP/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+Gymn/////////////////////////////////cMBO/1+5Of9fuTn/X7k5/1+5Of9fuTn/pNeP////////////vOGs/4zMcP///////////6TXj/9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of////////////////+k14//0evG////////////hspp/1+5Of9fuTn/X7k5/1+5Of9fuTn/cMBO/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3rFWv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/7Ddnf///////////////////////////3DATv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3DATv///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9Hrxv9juz3/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9rvkj///////////////////////////9wwE7/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+T0Hn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/4zMcP//////////////////////cMBO/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/cMBO/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////4zMcP9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9juz3/0evG/////////////////3DATv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3DATv//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////k9B5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/2O7Pf+c1IX/k9B5/4bKaf+Ax2L/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3rFWv////////////////9wwE7/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////90w1P/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/gMdi/////////////////3rFWv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/pNeP////////////cMBO/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/cMBO////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////0evG/2O7Pf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+k14////////////+84az/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3DATv////////////////////////////////////////////////////////////////////////////////9wwE7/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/hspp//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+T0Hn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/a75I/////////////////4bKaf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/nNSF////////////////////////////////////////////////////////////////////////////cMBO/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/4bKaf///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3DATv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+MzHD////////////R68b/Y7s9/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/2e9Q////////////////////////////////////////////////////////////////////////////3DATv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+Gymn///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+w3Z3/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/Y7s9/9Hrxv///////////4bKaf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9nvUP/a75I/3DATv9wwE7/cMBO/3DATv9wwE7/cMBO/3DATv9wwE7/cMBO/3DATv9wwE7/cMBO/3DATv9juz3/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/Z71D/3DATv9wwE7/cMBO/3DATv9wwE7/cMBO/3DATv9wwE7/cMBO/3DATv9wwE7/cMBO/3DATv+Ax2L//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3rFWv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of96xVr////////////R68b/Y7s9/1+5Of9fuTn/X7k5/1+5Of+Gymn/0evG/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/cMBO//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+84az/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/7zhrP///////////4bKaf9fuTn/X7k5/3DATv+84az///////////9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3DATv///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3rFWv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of96xVr////////////R68b/a75I/5zUhf//////////////////////X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+84az/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/6TXj////////////////////////////////////////////1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/cMBO/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3rFWv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7///////////////////////////////////////////9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/3DATv////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+k14//X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/7Ddnf//////////////////////////////////////X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of9wwE7//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////2u+SP9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of96xVr/////////////////////////////////////////////////////////////////////////////////////////////////////////////////cMBO/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/4bKaf////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+T0Hn/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/7zhrP///////////////////////////////////////////////////////////////////////////////////////////////////////////3DATv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+Gymn/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////0evG/2O7Pf9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+Gymn///////////////////////////////////////////////////////////////////////////////////////////////////////////9wwE7/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/hspp//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////96xVr/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/a75I////////////////////////////////////////////////////////////////////////////////////////////////////////////cMBO/1+5Of9fuTn/X7k5/1+5Of9fuTn/X7k5/4bKaf//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////sN2d/1+5Of9fuTn/X7k5/1+5Of90w1P/nNSF/////////////////////////////////////////////////////////////////////////////////////////////////////////////////3DATv9fuTn/X7k5/1+5Of9fuTn/X7k5/1+5Of+Gymn///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9nvUP/Z71D/4bKaf+84az///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9wwE7/X7k5/1+5Of9fuTn/X7k5/1+5Of9fuTn/hspp////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////sN2d////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"


def select_area():
    global GDATA
    GDATA["record_area"] = tk.Toplevel()
    GDATA["record_area"].attributes("-fullscreen", True)
    GDATA["record_area"].attributes("-alpha", 0.3)
    GDATA["record_area"].configure(background="black")

    instruction = tk.Label(
        GDATA["record_area"], text="用滑鼠框選訓練畫面範圍", bg="white"
    )
    instruction.pack()

    canvas = tk.Canvas(GDATA["record_area"], cursor="cross")
    canvas.pack(fill="both", expand=True)

    GDATA["rect"] = None

    def on_button_press(event):
        global GDATA
        GDATA["x1"], GDATA["y1"] = event.x, event.y
        GDATA["rect"] = canvas.create_rectangle(
            event.x, event.y, event.x, event.y, outline="red"
        )

    def on_move_press(event):
        global GDATA
        GDATA["x2"], GDATA["y2"] = event.x, event.y
        canvas.coords(GDATA["rect"], GDATA["x1"], GDATA["y1"], GDATA["x2"], GDATA["y2"])

    def on_button_release(event):
        GDATA["record_area"].grab_release()  # 釋放滑鼠事件
        GDATA["record_area"].destroy()

    canvas.bind("<ButtonPress-1>", on_button_press)
    canvas.bind("<B1-Motion>", on_move_press)
    canvas.bind("<ButtonRelease-1>", on_button_release)

    GDATA["record_area"].grab_set_global()  # 捕獲滑鼠事件


def start_recording():
    global GDATA
    # Lock UI
    ui_enable_disable(False)

    t = str(int(time.time()))

    print("x1, y1: %s, %s" % (GDATA["x1"], GDATA["y1"]))
    print("x2, y2: %s, %s" % (GDATA["x2"], GDATA["y2"]))
    if GDATA["recording"]:
        messagebox.showwarning("警告", "錄影已經在進行中！")
        return
    if GDATA["x1"] == GDATA["x2"] or GDATA["y1"] == GDATA["y2"]:
        messagebox.showwarning("警告", "請先選擇錄影範圍！")
        return
    GDATA["UI"]["progress_label"].config(text="影像截取中...")
    GDATA["recording"] = True

    w = GDATA["x2"] - GDATA["x1"]
    h = GDATA["y2"] - GDATA["y1"]
    # GDATA["out"] = cv2.VideoWriter(GDATA["video_file"], cv2.VideoWriter_fourcc(*"MP4V"), GDATA["fps"], (w, h))
    GDATA["frame_list"] = []
    GDATA["THREAD"]["video_thread"] = threading.Thread(target=record_video)
    GDATA["THREAD"]["process_thread"] = threading.Thread(target=process_frames)

    GDATA["THREAD"]["video_thread"].start()
    GDATA["THREAD"]["process_thread"].start()

    GDATA["UI"]["start_button"].config(state=tk.DISABLED)
    GDATA["UI"]["stop_button"].config(state=tk.NORMAL)


def ui_enable_disable(bool_val):
    global GDATA
    if bool_val == True:
        GDATA["UI"]["select_area_button"].config(state=tk.NORMAL)
        GDATA["UI"]["compression_level_selected_menu"].config(state=tk.NORMAL)
        GDATA["UI"]["exit_button"].config(state=tk.NORMAL)
    else:
        GDATA["UI"]["select_area_button"].config(state=tk.DISABLED)
        GDATA["UI"]["compression_level_selected_menu"].config(state=tk.DISABLED)
        GDATA["UI"]["exit_button"].config(state=tk.DISABLED)


def process_frames():
    global GDATA
    w = GDATA["x2"] - GDATA["x1"]
    h = GDATA["y2"] - GDATA["y1"]
    GDATA["out"] = cv2.VideoWriter(
        GDATA["video_file"], cv2.VideoWriter_fourcc(*"MP4V"), GDATA["fps"], (w, h)
    )
    last_frame_time = None

    # 每一幀間隔時間
    frame_step_time = 1 / GDATA["fps"]

    while GDATA["recording"] or len(GDATA["frame_list"]) > 0:
        if len(GDATA["frame_list"]) > 0:
            current_frame_data = GDATA["frame_list"].pop(0)
            current_time = current_frame_data["timestamp"]
            current_frame = current_frame_data["frame"]

            if last_frame_time is None:
                # 第一幀
                last_frame_time = current_time
                frame_rgb = cv2.cvtColor(np.array(current_frame), cv2.COLOR_RGBA2RGB)
                GDATA["out"].write(frame_rgb)
            else:
                # 計算時間差
                time_diff = current_time - last_frame_time
                if time_diff < frame_step_time:
                    # 超速了 這張多截的，不要
                    continue
                else:
                    # 按照時間差計算需要插入的幀數
                    # 用 int 取代 math.floor
                    frame_times = int(time_diff / frame_step_time)
                    for _ in range(frame_times):
                        frame_rgb = cv2.cvtColor(
                            np.array(current_frame), cv2.COLOR_RGBA2RGB
                        )
                        GDATA["out"].write(frame_rgb)
                    last_frame_time += (
                        frame_times * frame_step_time
                    )  # 更新最後一幀的時間
        time.sleep(0.001)  # 避免空循環佔用太多 CPU

    GDATA["out"].release()
    cv2.destroyAllWindows()


def record_video():
    global GDATA
    w = GDATA["x2"] - GDATA["x1"]
    h = GDATA["y2"] - GDATA["y1"]
    # 設置屏幕捕獲
    monitor = {"top": GDATA["y1"], "left": GDATA["x1"], "width": w, "height": h}
    # 幀時間間隔
    frame_time = 1 / GDATA["fps"]

    # 畫質
    _compression_level = GDATA["UI"]["compression_level_selected"].get()

    GDATA["frame_count"] = 0
    GDATA["run_start_time"] = time.time()
    GDATA["start_time"] = time.time()

    sct = mss.mss(compression_level=_compression_level, with_cursor=False)
    while GDATA["recording"]:
        # if is_need_cursor == True:
        #    # 這樣才會一直更新滑鼠位置
        #    # 後來直接改 mss/windows.py #328 與 #329 #367 的地方
        #    # mss/base.py #240~#243 回收 ram
        #    # 一直重新宣告 sct 造成記憶體肥大 crash
        #    sct = mss.mss(compression_level=_compression_level,with_cursor=is_need_cursor)
        # 記錄當前時間
        GDATA["frame_count"] += 1
        ct = time.time()
        elapsed_time = ct - GDATA["start_time"]

        # 截取指定區域的圖像
        try:
            GDATA["frame_list"].append({"timestamp": ct, "frame": sct.grab(monitor)})
        except:
            pass
        if elapsed_time >= 1.0:
            current_fps = GDATA["frame_count"] / elapsed_time
            GDATA["frame_count"] = 0
            GDATA["start_time"] = time.time()

    # out.release()
    # cv2.destroyAllWindows()


def stop_recording():
    global GDATA

    if not GDATA["recording"]:
        messagebox.showwarning("警告", "錄影未開始！")
        return
    # Hide fps
    GDATA["UI"]["fps_label"].set("")
    GDATA["recording"] = False
    ui_enable_disable(True)

    # 影片最後才結束
    # time.sleep(3);
    GDATA["THREAD"]["video_thread"].join()
    GDATA["THREAD"]["process_thread"].join()
    GDATA["UI"]["start_button"].config(state=tk.NORMAL)
    GDATA["UI"]["stop_button"].config(state=tk.DISABLED)
    messagebox.showinfo("提示", "錄影已停止")


def open_folder():
    global GDATA
    folder_path = os.path.dirname(os.path.abspath("data" + my.SP() + "projects"))
    webbrowser.open(folder_path)


def browser_folder():
    # 用瀏覽器開啟 http://localhost:9487
    webbrowser.open("http://localhost:9487")


def on_message():
    global MESSAGE
    messagebox.showinfo("說明", MESSAGE)


def on_closing():
    global GDATA
    if GDATA["recording"]:
        if messagebox.askokcancel("離開", "錄影正在進行，確定要離開嗎？"):
            stop_recording()
            root.destroy()
            os._exit(1)
    else:
        root.destroy()
        os._exit(1)


# 函數：鼠標按下時的位置
def win_start_move(event):
    root.x = event.x
    root.y = event.y


def win_stop_move(event):
    root.x = None
    root.y = None


def win_do_move(event):
    deltax = event.x - root.x
    deltay = event.y - root.y
    x = root.winfo_x() + deltax
    y = root.winfo_y() + deltay
    root.geometry(f"+{x}+{y}")


def project_get_list_all():
    # 取得所有專案檔
    global GDATA
    project_list = []
    for project in os.listdir(GDATA["pwd"] + "\\data\\projects"):
        if os.path.isdir(GDATA["pwd"] + "\\data\\projects\\" + project):
            project_list.append(project)
    return project_list


def new_project():
    # 新增專案檔
    # 會出現 prompt 讓使用者輸入專案檔名稱
    global GDATA
    project_name = simpledialog.askstring("新增專案檔", "請輸入專案檔名稱")
    if project_name is None:
        return
    if project_name == "":
        messagebox.showwarning("警告", "專案檔名稱不可為空！")
        return
    if project_name in project_get_list_all():
        messagebox.showwarning("警告", "專案檔名稱已存在！")
        return
    my.mkdir(
        GDATA["pwd"] + my.SP() + "data" + my.SP() + "projects" + my.SP() + project_name
    )
    # 繼續建立 dataset 與 my_dataset
    my.mkdir(
        GDATA["pwd"] + my.SP() + "data" + my.SP() + "projects" + my.SP() + project_name + my.SP() + "dataset"
    )
    my.mkdir(
        GDATA["pwd"] + my.SP() + "data" + my.SP() + "projects" + my.SP() + project_name + my.SP() + "my_dataset"
    )
    messagebox.showinfo("提示", "新增專案檔成功！")

    # 更新下拉選單，重新取得專案檔列表 並且設定選擇的專案檔
    GDATA["UI"]["select_project_selected_menu"]["menu"].delete(0, "end")
    GDATA["UI"]["select_project_selected"].set("選擇專案檔")
    for project in project_get_list_all():
        GDATA["UI"]["select_project_selected_menu"]["menu"].add_command(
            label=project,
            command=tk._setit(GDATA["UI"]["select_project_selected"], project),
        )
        GDATA["UI"]["select_project_selected_menu"].pack(side=tk.LEFT, padx=5)
        GDATA["UI"]["select_area_button"].config(state=tk.NORMAL)

def project_selected(self,a,b):
    global GDATA
    project = GDATA["UI"]["select_project_selected"].get()
    if project == "選擇專案檔":
        GDATA["UI"]["select_area_button"].config(state=tk.DISABLED)
        return
    GDATA["project"] = project
    GDATA["UI"]["select_area_button"].config(state=tk.NORMAL)


root = tk.Tk()

# 將 base64 字符串解碼為二進制數據
binary_data = base64.b64decode(icon_b64)

# 釋放 ram
icon_b64 = None

# 將二進制數據寫入文件
with open(GDATA["pwd"] + "\\tmp_icon.ico", "wb") as f:
    f.write(binary_data)
binary_data = None


# 設置窗口圖標
root.iconbitmap(GDATA["pwd"] + "\\tmp_icon.ico")
if os.path.isfile(GDATA["pwd"] + "\\tmp_icon.ico"):
    os.remove(GDATA["pwd"] + "\\tmp_icon.ico")

# 計算窗口位置
screen_width = root.winfo_screenwidth()
screen_height = root.winfo_screenheight()
window_width = 420  # 假設窗口寬度為 450
window_height = 140  # 假設窗口高度為  140

# 計算窗口位置: 右下角150px，距離底部30%
x = screen_width - window_width - 150
y = int(screen_height * 0.7)

# 設置窗口位置和大小
root.geometry(f"{window_width}x{window_height}+{x}+{y}")

# 設置窗口不可縮放
root.resizable(False, False)

root.title(f"我的悠嘍訓練機 - V{GDATA["VERSION"]} By 羽山秋人 (https://3wa.tw)")

# 使用Frame將按鈕排成一行
# 第一列
GDATA["UI"]["first_frame"] = tk.Frame(root)
GDATA["UI"]["first_frame"].pack(padx=5,pady=10, fill=tk.X)

GDATA["UI"]["exit_button"] = tk.Button(
    GDATA["UI"]["first_frame"], text="離開程式", command=on_closing
)
GDATA["UI"]["exit_button"].pack(side=tk.RIGHT, padx=5)

GDATA["UI"]["info_button"] = tk.Button(
    GDATA["UI"]["first_frame"], text="說明", command=on_message
)
GDATA["UI"]["info_button"].pack(side=tk.RIGHT, padx=5)




# 以下放到第二行
# 第二列

GDATA["UI"]["second_frame"] = tk.Frame(root)
GDATA["UI"]["second_frame"].pack(padx=5,fill=tk.X)

# 新增專案檔，按到會出現 prompt 讓使用者輸入專案檔名稱
GDATA["UI"]["new_project_button"] = tk.Button(
    GDATA["UI"]["second_frame"], text="新增專案檔", command=new_project
)
GDATA["UI"]["new_project_button"].pack(side=tk.LEFT, padx=5)

# 下拉選單，選擇專案檔
GDATA["UI"]["select_project_selected"] = tk.StringVar()
GDATA["UI"]["select_project_selected"].set("選擇專案檔")
GDATA["UI"]["select_project_selected_menu"] = tk.OptionMenu(
    GDATA["UI"]["second_frame"], GDATA["UI"]["select_project_selected"], "選擇專案檔"
)
# 更新下拉選單，重新取得專案檔列表 並且設定選擇的專案檔
GDATA["UI"]["select_project_selected_menu"]["menu"].delete(0, "end")
GDATA["UI"]["select_project_selected"].set("選擇專案檔")
for project in project_get_list_all():
    GDATA["UI"]["select_project_selected_menu"]["menu"].add_command(
        label=project,
        command=tk._setit(GDATA["UI"]["select_project_selected"], project),
    )
    GDATA["UI"]["select_project_selected_menu"].pack(side=tk.LEFT, padx=5)
    #GDATA["UI"]["select_area_button"].config(state=tk.NORMAL)
GDATA["UI"]["select_project_selected_menu"].pack(side=tk.LEFT, padx=5)
# 選到專案檔後，才能選擇錄影範圍
GDATA["UI"]["select_project_selected"].trace("w", project_selected)

GDATA["UI"]["execute_folder_button"] = tk.Button(
    GDATA["UI"]["second_frame"], text="編輯訓練檔", command=browser_folder,
    state=tk.DISABLED
)
GDATA["UI"]["execute_folder_button"].pack(side=tk.LEFT, padx=5)

GDATA["UI"]["open_folder_button"] = tk.Button(
    GDATA["UI"]["second_frame"], text="資料夾", command=open_folder
)
GDATA["UI"]["open_folder_button"].pack(side=tk.LEFT, padx=5)


# 第三列
GDATA["UI"]["third_frame"] = tk.Frame(root)
GDATA["UI"]["third_frame"].pack(padx=5,pady=10,fill=tk.X)


# 選擇錄影範圍 必需有專案檔才能選擇
GDATA["UI"]["select_area_button"] = tk.Button(
    GDATA["UI"]["third_frame"],
    text="選擇錄影範圍",
    command=select_area,
    state=tk.DISABLED
)
GDATA["UI"]["select_area_button"].pack(side=tk.LEFT, padx=5)

GDATA["UI"]["start_button"] = tk.Button(
    GDATA["UI"]["third_frame"], text="開始錄影", command=start_recording
)
GDATA["UI"]["start_button"].pack(side=tk.LEFT, padx=5)

GDATA["UI"]["stop_button"] = tk.Button(
    GDATA["UI"]["third_frame"],
    text="停止錄影",
    command=stop_recording,
    state=tk.DISABLED,
)
GDATA["UI"]["stop_button"].pack(side=tk.LEFT, padx=5)










root.protocol("WM_DELETE_WINDOW", on_closing)


# 綁定標題欄的鼠標按下事件
root.bind("<ButtonPress-1>", win_start_move)
root.bind("<ButtonRelease-1>", win_stop_move)
root.bind("<B1-Motion>", win_do_move)


# 跑一個本地的 flask server port 9487
# 這樣就可以在網頁上看到 www/index.html 的畫面
# 程式開始
# 用 thread 跑
def run_flask():
    app = Flask(__name__, template_folder="www", static_folder="www")

    @app.route("/")
    def home():
        return render_template("index.html")

    @app.route("/api")
    def api():
        GETS = request.args
        if "mode" in GETS:
            mode = GETS["mode"]
            if mode == "project_list":
                _PWD = os.getcwd()
                projects = my.glob_dirs(
                    _PWD + my.SP() + "data" + my.SP() + "projects" + my.SP() + "*"
                )
                projects = [os.path.basename(p) for p in projects]
                return jsonify({"status": "OK", "data": projects})
        return jsonify({"status": "OK"})

    @app.route("/datetime", methods=["GET", "POST"])
    def datetime():
        return my.date("Y-m-d H:i:s")

    @app.route("/test", methods=["GET", "POST"])
    def test():
        # 獲取 GET 或 POST 請求中的數據
        string_fields = request.args  # 對於 GET 請求
        if request.method == "POST":
            string_fields = request.form  # 對於 POST 請求

        output = {}
        for key in string_fields:
            output[key] = string_fields[key]

        return output

    app.run(debug=True, host='127.0.0.1', port=9487, threaded=True, use_reloader=False)


threading.Thread(target=run_flask).start()


root.mainloop()
